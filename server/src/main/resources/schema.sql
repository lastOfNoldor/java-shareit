CREATE TABLE IF NOT EXISTS users (
id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
name VARCHAR(100) NOT NULL,
email VARCHAR(100) NOT NULL,
CONSTRAINT UQ_USER_EMAIL UNIQUE (email)
);

CREATE TABLE IF NOT EXISTS items (
id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
name VARCHAR(100) NOT NULL,
description TEXT,
available BOOLEAN NOT NULL,
owner_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS bookings (
id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
start_date TIMESTAMP NOT NULL,
end_date TIMESTAMP NOT NULL,
booker_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
item_id BIGINT NOT NULL REFERENCES items(id) ON DELETE CASCADE,
status VARCHAR(40)
);

CREATE TABLE IF NOT EXISTS comments (
id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
text TEXT NOT NULL,
item_id BIGINT REFERENCES items(id),
author_id BIGINT REFERENCES users(id),
created TIMESTAMP NOT NULL
);

CREATE TABLE IF NOT EXISTS requests (
id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
description VARCHAR(1000) NOT NULL,
requester_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
created TIMESTAMP NOT NULL
);

ALTER TABLE bookings ADD CONSTRAINT chk_booking_dates CHECK (end_date > start_date);
ALTER TABLE bookings ADD CONSTRAINT chk_booking_status CHECK (status IN ('WAITING', 'APPROVED', 'REJECTED', 'CANCELED'));
